<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Investment Platform</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
  }
  .container {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    max-width: 400px;
    width: 100%;
    text-align: center;
  }
  h2 { color: #333; }
  label {
    display: block;
    margin-top: 15px;
    margin-bottom: 5px;
    color: #555;
  }
  input, select, button {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 16px;
  }
  button {
    background: #0f3d66;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover { background: #0a2a45; }
  .result {
    margin-top: 20px;
    padding: 15px;
    background: #e6f0ff;
    border-radius: 8px;
    font-weight: bold;
    color: #0f3d66;
  }
  .popup {
    display: none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  .popup-content {
    background: white;
    padding: 25px;
    border-radius: 12px;
    width: 90%;
    max-width: 400px;
    text-align: left;
    position: relative;
  }
  .popup-content h3 { text-align: center; }
  .close-btn {
    position: absolute;
    top:10px; right:15px;
    cursor:pointer;
    font-size: 20px;
  }
</style>
</head>
<body>

<div class="container">
  <h2>Investment Calculator</h2>
  <label for="amount">Investment Amount (₹):</label>
  <input type="number" id="amount" placeholder="Enter amount" />

  <label for="days">Select Investment Period:</label>
  <select id="days">
    <option value="365">365 days (12% annualized)</option>
    <option value="182">182 days (9% annualized)</option>
    <option value="90">90 days (6% annualized)</option>
    <option value="30">30 days (3% annualized)</option>
  </select>

  <button id="calcBtn">Calculate Earnings</button>
  <button id="investBtn">Invest Now</button>
  <button id="checkBtn">Check My Investment</button>

  <div class="result" id="result">
    Enter amount and select period to see your earnings.
  </div>
</div>

<!-- Investment Form Popup -->
<div class="popup" id="popupForm">
  <div class="popup-content">
    <span class="close-btn" id="closeForm">×</span>
    <h3>Investment Form</h3>
    <label>Name:</label>
    <input type="text" id="fname" required>
    <label>Email:</label>
    <input type="email" id="femail" required>
    <label>Mobile:</label>
    <input type="text" id="fmobile" required>
    <label>Amount (≥ ₹2000):</label>
    <input type="number" id="famount" required>
    <label>Your UPI ID:</label>
    <input type="text" id="fupi" placeholder="example@okhdfcbank" required>
    <label>Investment Period:</label>
    <select id="fdays">
      <option value="365">365 days (12% annualized)</option>
      <option value="182">182 days (9% annualized)</option>
      <option value="90">90 days (6% annualized)</option>
      <option value="30">30 days (3% annualized)</option>
    </select>
    <button id="submitBtn">Submit & Pay</button>
  </div>
</div>

<!-- Check Investment Popup -->
<div class="popup" id="popupCheck">
  <div class="popup-content">
    <span class="close-btn" id="closeCheck">×</span>
    <h3>Check My Investment</h3>
    <label>Enter Mobile Number:</label>
    <input type="text" id="checkMobile" placeholder="Enter your registered mobile">
    <button id="getInvestment">View Investment</button>
    <div id="investmentResult" style="margin-top:15px; font-weight:bold;"></div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){
  const resultDiv = document.getElementById('result');
  const popup = document.getElementById('popupForm');
  const popupCheck = document.getElementById('popupCheck');
  const investmentResult = document.getElementById('investmentResult');
  const scriptURL = "https://script.google.com/macros/s/AKfycbwMreqOTRYOYKi0jPapCKHeei7xcJBbtIFDFncfVqPqOz0_hrvOpzqsSfsNRlkhOn1K/exec";

  // Calculate Earnings
  document.getElementById('calcBtn').addEventListener('click', function() {
    const amount = parseFloat(document.getElementById('amount').value);
    const days = parseInt(document.getElementById('days').value);
    const rate = days===365?12:days===182?9:days===90?6:3;

    if(isNaN(amount) || amount < 2000){
      resultDiv.innerText = "Minimum Investment Amount should be ₹2000.";
      return;
    }

    const interest = (amount * rate * days) / (365 * 100);
    const total = amount + interest;

    resultDiv.innerHTML = `
      Investment Amount: ₹${amount.toFixed(2)}<br>
      Duration: ${days} days<br>
      Interest Earned: ₹${interest.toFixed(2)}<br>
      Total Amount after ${days} days: ₹${total.toFixed(2)}
    `;
  });

  // Popup Controls
  document.getElementById('investBtn').addEventListener('click', ()=> popup.style.display = "flex");
  document.getElementById('closeForm').addEventListener('click', ()=> popup.style.display = "none");
  document.getElementById('checkBtn').addEventListener('click', ()=> popupCheck.style.display = "flex");
  document.getElementById('closeCheck').addEventListener('click', ()=> popupCheck.style.display = "none");

  // Submit Investment
  document.getElementById('submitBtn').addEventListener('click', async function(){
    const name = document.getElementById('fname').value.trim();
    const email = document.getElementById('femail').value.trim();
    const mobile = document.getElementById('fmobile').value.trim();
    const amount = parseFloat(document.getElementById('famount').value);
    const upi = document.getElementById('fupi').value.trim();
    const days = parseInt(document.getElementById('fdays').value);

    if(!name || !email || !mobile || !upi || isNaN(amount) || amount < 2000){
      alert("Please fill all fields correctly. Minimum amount is ₹2000.");
      return;
    }

    const rate = days===365?12:days===182?9:days===90?6:3;
    const date = new Date().toLocaleDateString('en-GB'); // dd/mm/yyyy

    try{
      const formData = new FormData();
      formData.append('name', name);
      formData.append('email', email);
      formData.append('mobile', mobile);
      formData.append('upi', upi);
      formData.append('amount', amount);
      formData.append('days', days);
      formData.append('rate', rate);
      formData.append('date', date);

      const response = await fetch(scriptURL, { method: 'POST', body: formData });

      if(response.ok){
        const upiID = "rajvendrarao@okhdfcbank";
        const nameUPI = "Rajvendra Singh Rao";
        const txnAmount = amount.toFixed(2);
        const txnNote = "Investment by " + name;
        const upiURL = `upi://pay?pa=${upiID}&pn=${encodeURIComponent(nameUPI)}&am=${txnAmount}&cu=INR&tn=${encodeURIComponent(txnNote)}`;
        window.location.href = upiURL;
      } else {
        alert("Error submitting form. Try again.");
      }
    } catch(err){
      console.error(err);
      alert("Error connecting to server.");
    }
  });

  // Fetch Investment & Calculate Interest Progress
  document.getElementById('getInvestment').addEventListener('click', async ()=>{
    const mobile = document.getElementById('checkMobile').value.trim();
    if(!mobile){
      alert("Please enter your registered mobile number.");
      return;
    }

    investmentResult.innerHTML = "Checking, please wait...";
    try {
      const res = await fetch(`${scriptURL}?mobile=${mobile}`);
      const data = await res.json();

      if(data && data.status === "success"){
        const startDateParts = data.date.split('/');
        const startDate = new Date(`${startDateParts[2]}-${startDateParts[1]}-${startDateParts[0]}`);
        const today = new Date();
        const daysPassed = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
        const progressDays = Math.min(daysPassed, data.days);
        const interestEarned = (data.amount * data.rate * progressDays) / (365 * 100);

        investmentResult.innerHTML = `
          Name: ${data.name}<br>
          Amount Invested: ₹${data.amount}<br>
          Period: ${data.days} days<br>
          Rate: ${data.rate}%<br>
          Date: ${data.date}<br><br>
          <b>Days Passed:</b> ${progressDays} days<br>
          <b>Interest Earned So Far:</b> ₹${interestEarned.toFixed(2)}
        `;
      } else {
        investmentResult.innerHTML = "No investment found for this mobile number.";
      }
    } catch(err){
      console.error(err);
      investmentResult.innerHTML = "Error fetching details.";
    }
  });
});
</script>
</body>
</html>
